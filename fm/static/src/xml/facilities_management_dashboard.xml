<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <!-- Main Dashboard View Template -->
    <t t-name="fm.DashboardView">
        <div class="o_facilities_dashboard_view">
            <!-- Dashboard Header -->
            <div class="o_dashboard_header">
                <div class="o_dashboard_title">
                    <h2><i class="fa fa-dashboard"/> Facilities Management Dashboard</h2>
                </div>
                <div class="o_dashboard_controls">
                    <select class="form-select" t-model="state.selectedPeriod" t-on-change="onPeriodChange">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Period</option>
                    </select>
                    <button class="btn btn-secondary ms-2" t-on-click="onRefresh" title="Refresh Dashboard">
                        <i class="fa fa-refresh"/> Refresh
                    </button>
                    <button class="btn btn-primary ms-2" t-on-click="onOpenDashboard" title="Configure Dashboard">
                        <i class="fa fa-cog"/> Configure
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div t-if="state.loading" class="o_dashboard_loading">
                <div class="text-center">
                    <i class="fa fa-spinner fa-spin fa-3x text-primary"/>
                    <p class="mt-3">Loading dashboard data...</p>
                </div>
            </div>

            <!-- Error State -->
            <div t-elif="state.error" class="o_dashboard_error">
                <div class="alert alert-danger" role="alert">
                    <i class="fa fa-exclamation-triangle"/> <strong>Error:</strong>
                    <t t-esc="state.error"/>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div t-else="" class="o_dashboard_content">
                <!-- KPIs Row -->
                <div class="o_dashboard_kpis row g-3 mb-4" t-if="state.data and state.data.kpis">
                    <t t-foreach="state.data.kpis" t-as="kpi" t-key="kpi_index">
                        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6">
                            <KPICardWidget data="kpi"/>
                        </div>
                    </t>
                </div>

                <!-- Charts Row -->
                <div class="o_dashboard_charts row g-3 mb-4" t-if="state.data and state.data.charts">
                    <t t-foreach="state.data.charts" t-as="chart" t-key="chart_index">
                        <div class="col-xl-6 col-lg-6 col-md-12">
                            <ChartWidget data="chart"/>
                        </div>
                    </t>
                </div>

                <!-- Table Section -->
                <div t-if="state.data and state.data.tables" class="o_dashboard_tables">
                    <TableWidget data="state.data.tables"/>
                </div>

                <!-- Last Updated Info -->
                <div t-if="state.data and state.data.metadata and state.data.metadata.last_updated" class="o_dashboard_footer mt-4">
                    <small class="text-muted">
                        <i class="fa fa-clock-o"/> Last updated: 
                        <t t-esc="state.data.metadata.last_updated"/>
                    </small>
                </div>
            </div>
        </div>
    </t>

    <!-- KPI Card Template -->
    <t t-name="fm.KPICardWidget">
        <div class="o_kpi_card card h-100" t-on-click="onCardClick" t-att-class="props.data.action ? 'cursor-pointer' : ''">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="o_kpi_icon me-3">
                        <i t-attf-class="fa {{props.data.icon}} fa-3x text-{{props.data.color}}"/>
                    </div>
                    <div class="o_kpi_content flex-grow-1">
                        <div class="o_kpi_name text-muted mb-1">
                            <t t-esc="props.data.name"/>
                        </div>
                        <div class="o_kpi_value h2 mb-2">
                            <t t-esc="props.data.value"/>
                        </div>
                        <div t-if="variance != 0" class="o_kpi_variance small" t-att-class="varianceClass">
                            <i t-att-class="varianceIcon"/>
                            <t t-esc="Math.abs(variance)"/>% vs previous
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>

    <!-- Chart Widget Template -->
    <t t-name="fm.ChartWidget">
        <div class="o_chart_widget card h-100">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="fa fa-bar-chart me-2"/>
                    <t t-esc="props.data.title"/>
                </h5>
            </div>
            <div class="card-body">
                <div class="o_chart_container" style="position: relative; height: 300px;">
                    <canvas t-ref="chart"/>
                </div>
            </div>
        </div>
    </t>

    <!-- Table Widget Template -->
    <t t-name="fm.TableWidget">
        <div class="o_table_widget card">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="fa fa-table me-2"/>
                    <t t-esc="props.data.title"/>
                </h5>
            </div>
            <div class="card-body p-0">
                <div t-if="hasData" class="table-responsive">
                    <table class="table table-hover table-striped mb-0">
                        <thead class="table-light">
                            <tr>
                                <t t-foreach="props.data.columns" t-as="column" t-key="column_index">
                                    <th><t t-esc="column"/></th>
                                </t>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="props.data.rows" t-as="row" t-key="row_index">
                                <tr>
                                    <t t-foreach="row" t-as="cell" t-key="cell_index">
                                        <td><t t-esc="cell"/></td>
                                    </t>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
                <div t-else="" class="p-4 text-center text-muted">
                    <i class="fa fa-inbox fa-3x mb-3"/>
                    <p>No data available</p>
                </div>
            </div>
        </div>
    </t>

    <!-- Client Action Template -->
    <t t-name="fm.DashboardClientAction">
        <div class="o_action_manager">
            <FacilitiesManagementDashboard t-if="state.resId" resId="state.resId"/>
        </div>
    </t>

</templates>

