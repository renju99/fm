<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Responsive Workorder Form View - Works on both Web and Mobile -->
    <record id="view_workorder_responsive_form" model="ir.ui.view">
        <field name="name">facilities.workorder.responsive.form</field>
        <field name="model">facilities.workorder</field>
        <field name="priority" eval="30"/>
        <field name="arch" type="xml">
            <form string="Work Order" class="o_responsive_form">
                <header>
                    <!-- Hidden fields for modifiers -->
                    <field name="is_planned_workorder" invisible="1"/>
                    <field name="can_edit_asset_location" invisible="1"/>
                    <field name="can_edit_description" invisible="1"/>
                    <field name="can_edit_labor_timings" invisible="1"/>
                    <field name="can_edit_work_summary" invisible="1"/>
                    <field name="can_edit_parts_materials" invisible="1"/>
                    <field name="can_complete_workorder" invisible="1"/>
                    <field name="all_tasks_completed" invisible="1"/>
                    <field name="show_standalone_tasks" invisible="1"/>
                    <field name="show_maintenance_tasks" invisible="1"/>
                    
                    <!-- Desktop Status Overview - Hidden on mobile, shown on desktop -->
                    <div class="d-none d-md-block mb-3">
                        <div class="row mb-2">
                            <div class="col-12">
                                <h4 class="text-primary mb-2">
                                    <i class="fa fa-info-circle me-2" title="Work order status information"></i>Work Order Status Overview
                                </h4>
                            </div>
                        </div>
                        
                        <!-- Status Cards Row -->
                        <div class="row mb-3">
                            <!-- Work Order Operational Status -->
                            <div class="col-md-6 mb-2">
                                <div class="card border-primary h-100">
                                    <div class="card-header bg-primary text-white py-2">
                                        <h6 class="mb-0">
                                            <i class="fa fa-cogs me-2"></i>Operational Status
                                            <small class="float-end">Work Progress</small>
                                        </h6>
                                    </div>
                                    <div class="card-body p-2">
                                        <field name="state" widget="statusbar"
                                            statusbar_visible="draft,assigned,in_progress,on_hold,completed,cancelled"
                                            statusbar_colors='{"draft":"gray","assigned":"blue","in_progress":"orange","on_hold":"yellow","completed":"green","cancelled":"red"}'
                                            string="Work Order Status"/>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Approval Workflow Status -->
                            <div class="col-md-6 mb-2">
                                <div class="card border-warning h-100">
                                    <div class="card-header bg-warning text-dark py-2">
                                        <h6 class="mb-0">
                                            <i class="fa fa-clipboard-check me-2"></i>Approval Workflow Status
                                            <small class="float-end">Supervisor Approval</small>
                                        </h6>
                                    </div>
                                    <div class="card-body p-2">
                                        <field name="approval_state" widget="statusbar"
                                            statusbar_visible="draft,submitted,supervisor,approved,refused,cancelled"
                                            statusbar_colors='{"refused":"red","approved":"green","cancelled":"red"}'
                                            string="Approval Workflow Status"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mobile Status Overview - Hidden on desktop, shown on mobile -->
                    <div class="d-block d-md-none mb-3">
                        <!-- Status Overview Header -->
                        <div class="row mb-2">
                            <div class="col-12">
                                <h5 class="text-primary mb-2">
                                    <i class="fa fa-info-circle me-2" title="Information"></i>Status Overview
                                </h5>
                            </div>
                        </div>
                        
                        <!-- Work Order Operational Status -->
                        <div class="row mb-2">
                            <div class="col-12">
                                <div class="card border-primary shadow-sm">
                                    <div class="card-header bg-primary text-white py-2">
                                        <h6 class="mb-0">
                                            <i class="fa fa-cogs me-2"></i>Operational Status
                                            <small class="float-end">Work Progress</small>
                                        </h6>
                                    </div>
                                    <div class="card-body py-2">
                                        <field name="state" widget="selection" readonly="1" string="Work Order Status"
                                               decoration-info="state == 'draft'" 
                                               decoration-warning="state == 'in_progress'" 
                                               decoration-success="state == 'completed'" 
                                               decoration-danger="state == 'cancelled'"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Approval Workflow Status -->
                        <div class="row mb-2">
                            <div class="col-12">
                                <div class="card border-warning shadow-sm">
                                    <div class="card-header bg-warning text-dark py-2">
                                        <h6 class="mb-0">
                                            <i class="fa fa-clipboard-check me-2"></i>Approval Workflow Status
                                            <small class="float-end">Supervisor Approval</small>
                                        </h6>
                                    </div>
                                    <div class="card-body py-2">
                                        <field name="approval_state" widget="selection" readonly="1" string="Approval Workflow Status"
                                               decoration-info="approval_state == 'draft'" 
                                               decoration-warning="approval_state in ('submitted', 'supervisor')" 
                                               decoration-success="approval_state == 'approved'" 
                                               decoration-danger="approval_state == 'refused'"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row g-2 mt-2">
                            <div class="col-6">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-danger text-white py-2">
                                        <small><i class="fa fa-exclamation-triangle me-1"></i>Priority</small>
                                    </div>
                                    <div class="card-body py-2">
                                        <field name="priority" widget="selection" readonly="1" string="Priority Level" 
                                               decoration-info="priority == '0'" 
                                               decoration-warning="priority == '3'" 
                                               decoration-danger="priority == '4'"/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-info text-white py-2">
                                        <small><i class="fa fa-clock me-1"></i>SLA Status</small>
                                    </div>
                                    <div class="card-body py-2">
                                        <field name="sla_response_status" widget="selection" readonly="1" string="Response SLA Status"
                                               decoration-info="sla_response_status == 'on_time'" 
                                               decoration-warning="sla_response_status == 'at_risk'" 
                                               decoration-danger="sla_response_status == 'breached'"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Work Order Title - Responsive -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <h2 class="text-primary mb-0 text-center text-md-start">
                                <field name="name" readonly="1" string="Work Order Title"/>
                            </h2>
                        </div>
                    </div>
                    
                    <!-- Action Buttons - Responsive Layout -->
                    <div class="d-flex flex-wrap gap-2 mb-3 justify-content-center justify-content-md-start">
                        <!-- Work Order Operational Buttons -->
                        <button name="action_start_progress" type="object" string="Start Work" class="btn btn-success btn-sm"
                            invisible="state not in ('draft', 'assigned') or approval_state not in ('approved', 'draft', 'submitted', 'supervisor')"
                            icon="fa-play"/>
                        <button name="action_resume_work" type="object" string="Resume Work" class="btn btn-warning btn-sm"
                            invisible="state != 'on_hold'"
                            icon="fa-refresh"/>
                        <button name="action_complete" type="object" string="Mark Complete" class="btn btn-success btn-sm"
                            invisible="state in ('completed', 'cancelled') or not can_complete_workorder"
                            icon="fa-check"
                            confirm="Are you sure you want to mark this work order as completed?"/>
                        <button name="action_stop_work" type="object" string="Stop Work" class="btn btn-danger btn-sm"
                            invisible="state != 'in_progress'"
                            icon="fa-stop"/>
                        <button name="action_reopen_workorder" type="object" string="Reopen" class="btn btn-info btn-sm"
                            invisible="not can_reopen_workorder"
                            icon="fa-undo"/>
                        <button name="action_cancel" type="object" string="Cancel" class="btn btn-secondary btn-sm"
                            invisible="state in ('completed', 'cancelled')"/>
                        <button name="action_reset_to_draft" type="object" string="Reset to Draft" class="btn btn-secondary btn-sm"
                            invisible="state == 'draft'"
                            confirm="Are you sure you want to reset this work order to draft state?"/>
                        
                        <!-- Approval Workflow Buttons -->
                        <button name="action_submit_for_approval" type="object" string="Submit for Approval" class="btn btn-primary btn-sm"
                            invisible="approval_state != 'draft'"/>
                        <button name="action_supervisor_approve" type="object" string="Supervisor Approve" class="btn btn-primary btn-sm"
                            invisible="approval_state != 'submitted'"/>
                        <button name="action_refuse" type="object" string="Refuse" class="btn btn-danger btn-sm"
                            invisible="approval_state in ('refused', 'cancelled') or state == 'completed'"/>
                    </div>
                </header>

                <sheet>
                    <!-- SLA Status Section -->
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-secondary text-white">
                            <h5 class="mb-0"><i class="fa fa-clock me-2"></i>Service Level Agreement (SLA) Status</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <field name="sla_response_status" widget="badge" readonly="1" string="Response Time Status"/>
                                    <field name="sla_response_deadline" readonly="1" string="Response Deadline"/>
                                </div>
                                <div class="col-12 col-md-6">
                                    <field name="sla_resolution_status" widget="badge" readonly="1" string="Resolution Time Status"/>
                                    <field name="sla_resolution_deadline" readonly="1" string="Resolution Deadline"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Asset Information Section -->
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fa fa-cog me-2"></i>Equipment &amp; Location Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <field name="asset_id" readonly="not can_edit_asset_location" string="Equipment/Asset to Maintain" 
                                           options="{'no_create': True}" 
                                           placeholder="Select an asset to auto-fill location details"/>
                                    <field name="facility_id" readonly="1" string="Facility/Plant"/>
                                </div>
                                <div class="col-12 col-md-6">
                                    <field name="building_id" readonly="not can_edit_asset_location" string="Building"/>
                                    <field name="room_id" readonly="not can_edit_asset_location" string="Room/Area"/>
                                </div>
                            </div>
                            <div class="alert alert-info mt-2" role="alert">
                                <i class="fa fa-info-circle me-2" title="Information"></i>
                                <strong>Auto-fill Tip:</strong> When you select an asset, the building, floor, room, and facility will be automatically filled based on the asset's location.
                            </div>
                        </div>
                    </div>

                    <!-- Work Order Details Section -->
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fa fa-info-circle me-2" title="Information"></i>Work Order Details</h5>
                        </div>
                        <div class="card-body">
                            <!-- Planned vs Reactive Work Order Information -->
                            <div class="alert alert-info mb-3" role="alert" invisible="not is_planned_workorder">
                                <i class="fa fa-calendar me-2" title="Planned Work Order"></i>
                                <strong>Planned Work Order</strong>
                                <p class="mb-0 mt-2">This work order was automatically generated from a maintenance schedule.</p>
                            </div>
                            
                            <div class="alert alert-warning mb-3" role="alert" invisible="is_planned_workorder">
                                <i class="fa fa-exclamation-triangle me-2" title="Warning"></i>
                                <strong>Reactive/Unplanned Work Order</strong>
                                <p class="mb-0 mt-2">This work order was created manually in response to a new issue.</p>
                            </div>
                            
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <field name="reported_by" readonly="is_planned_workorder" string="Reported By" invisible="is_planned_workorder"/>
                                    <field name="work_order_type" readonly="is_planned_workorder" string="Work Order Type"/>
                                    <field name="schedule_id" readonly="1" string="Linked Maintenance Schedule" placeholder="Maintenance Schedule" invisible="work_order_type != 'preventive'"/>
                                    <field name="job_plan_id" readonly="1" string="Associated Job Plan Template" placeholder="Job Plan" invisible="work_order_type != 'preventive'"/>
                                </div>
                                <div class="col-12 col-md-6">
                                    <field name="planned_start_datetime" readonly="1" string="Planned Start Date and Time" invisible="not is_planned_workorder"/>
                                    <field name="planned_end_datetime" readonly="1" string="Planned End Date and Time" invisible="not is_planned_workorder"/>
                                    <field name="standard_operating_procedure" readonly="1" string="Standard Operating Procedure (SOP)" invisible="not is_planned_workorder"/>
                                </div>
                            </div>
                            
                            <div class="row g-3 mt-2">
                                <div class="col-12">
                                    <field name="description" readonly="not can_edit_description" string="Work Order Description" invisible="not is_planned_workorder"/>
                                    <field name="reported_issue" readonly="not can_edit_description" string="Reported Issue/Description" invisible="is_planned_workorder"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Time Tracking Section -->
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-warning text-white">
                            <h5 class="mb-0"><i class="fa fa-clock-o me-2"></i>Time Tracking &amp; Duration</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-12 col-md-6">
                                    <field name="actual_start_date" readonly="not can_edit_labor_timings or sla_dates_readonly" string="Actual Start Time"/>
                                    <field name="estimated_duration" readonly="1" string="Estimated Duration (Hours)"/>
                                </div>
                                <div class="col-12 col-md-6">
                                    <field name="actual_end_date" readonly="not can_edit_labor_timings or sla_dates_readonly" string="Actual End Time"/>
                                    <field name="actual_duration" readonly="1" string="Actual Duration (Hours)"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Parts & Labor Section -->
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-secondary text-white">
                            <h5 class="mb-0"><i class="fa fa-wrench me-2"></i>Parts &amp; Labor Costs</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3 mb-3">
                                <div class="col-12 col-md-6">
                                    <label for="total_assignment_labor_cost" class="form-label fw-bold text-muted mb-2">Total Labor Cost</label>
                                    <field name="total_assignment_labor_cost" readonly="1" nolabel="1"/>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label for="parts_cost" class="form-label fw-bold text-muted mb-2">Parts Cost</label>
                                    <field name="parts_cost" readonly="1" nolabel="1"/>
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-12 col-md-6">
                                    <label for="total_assignment_hours" class="form-label fw-bold text-muted mb-2">Total Work Hours</label>
                                    <field name="total_assignment_hours" readonly="1" nolabel="1"/>
                                </div>
                                <div class="col-12 col-md-6">
                                    <label for="total_assignment_minutes" class="form-label fw-bold text-muted mb-2">Total Work Minutes</label>
                                    <field name="total_assignment_minutes" readonly="1" nolabel="1"/>
                                </div>
                            </div>
                            
                            <!-- Assignment Completion Status Section -->
                            <div class="mb-3">
                                <h6 class="text-muted mb-3"><i class="fa fa-check-circle me-2" title="Completion status"></i>Assignment Completion Status</h6>
                                <div class="row g-3 mb-3">
                                    <div class="col-12 col-md-6">
                                        <label for="assignment_completion_percentage" class="form-label fw-bold text-muted mb-2">Completion Progress</label>
                                        <div class="d-flex align-items-center">
                                            <div class="progress flex-grow-1 me-2" style="height: 20px;">
                                                <div class="progress-bar" role="progressbar" 
                                                     style="width: 0%"
                                                     aria-valuenow="0"
                                                     aria-valuemin="0" aria-valuemax="100">
                                                    <span class="small"><field name="assignment_completion_percentage" nolabel="1" readonly="1"/>%</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-6">
                                        <label for="assignment_status_summary" class="form-label fw-bold text-muted mb-2">Status Summary</label>
                                        <field name="assignment_status_summary" readonly="1" nolabel="1"/>
                                    </div>
                                </div>
                                <div class="row g-3 mb-3">
                                    <div class="col-12">
                                        <div class="alert alert-success" role="alert" invisible="not can_complete_workorder">
                                            <i class="fa fa-info-circle me-2" title="Information"></i>
                                            <strong>Ready to Complete</strong>
                                            <p class="mb-0 mt-2">All technician assignments are completed. This work order can be marked as completed.</p>
                                        </div>
                                        <div class="alert alert-warning" role="alert" invisible="can_complete_workorder">
                                            <i class="fa fa-info-circle me-2" title="Information"></i>
                                            <strong>Cannot Complete Yet</strong>
                                            <p class="mb-0 mt-2">Some technician assignments are still in progress. Complete all assignments before closing this work order.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Technician Assignments Section -->
                            <div class="mb-3">
                                <h6 class="text-muted mb-3"><i class="fa fa-users me-2"></i>Technician Assignments &amp; Work Time</h6>
                                <div class="mb-3">
                                    <button name="action_add_technician_assignment" type="object" string="Add Technician" class="btn btn-primary btn-sm"
                                            icon="fa-plus" invisible="not can_edit_labor_timings"/>
                                </div>
                                <field name="assignment_ids" string="Technician Assignments" nolabel="1">
                                    <list editable="bottom" create="true" delete="true">
                                        <field name="technician_id" string="Technician" required="1" 
                                               options="{'no_create': True}" 
                                               placeholder="Select technician to auto-fill contact details"/>
                                        <field name="start_date" string="Start Time" required="1"/>
                                        <field name="end_date" string="End Time"/>
                                        <field name="work_hours" string="Hours" optional="show" readonly="1"/>
                                        <field name="work_minutes" string="Minutes" readonly="1"/>
                                        <field name="status" string="Status" widget="selection"/>
                                        <field name="hourly_rate" string="Hourly Rate" optional="show" readonly="1"/>
                                        <field name="labor_cost" string="Labor Cost" optional="show" readonly="1"/>
                                        <field name="notes" string="Notes" optional="show"/>
                                        <button name="action_start_work" type="object" string="Start" class="btn btn-success btn-sm" icon="fa-play"/>
                                        <button name="action_pause_work" type="object" string="Pause" class="btn btn-warning btn-sm" icon="fa-pause"/>
                                        <button name="action_resume_work" type="object" string="Resume" class="btn btn-info btn-sm" icon="fa-refresh"/>
                                        <button name="action_complete_work" type="object" string="Complete" class="btn btn-primary btn-sm" icon="fa-check"/>
                                    </list>
                                </field>
                                <div class="alert alert-info mt-2" role="alert">
                                    <i class="fa fa-info-circle me-2" title="Information"></i>
                                    <strong>Auto-fill Tip:</strong> When you select a technician, their contact details and hourly rate will be automatically filled.
                                </div>
                            </div>
                            
                            <field name="parts_used_ids" readonly="not can_edit_parts_materials" string="Parts Used" nolabel="1">
                                <list editable="bottom">
                                    <field name="product_id" string="Part/Component"/>
                                    <field name="quantity" string="Quantity Used"/>
                                </list>
                            </field>
                        </div>
                    </div>

                    <!-- Action Taken & Resolution Section -->
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fa fa-tools me-2"></i>Action Taken &amp; Resolution</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-3" role="alert" invisible="state != 'in_progress'">
                                <i class="fa fa-info-circle me-2" title="Information"></i>
                                <strong>Document your actions and resolution here while the work is in progress.</strong>
                            </div>
                            
                            <field name="action_taken_resolution" placeholder="Describe what was done to resolve the issue, including any troubleshooting steps, repairs made, and final resolution..." readonly="not can_edit_work_summary" string="Action Taken/Resolution"/>
                            
                            <field name="additional_notes" placeholder="Add any additional notes, observations, or comments here..." readonly="not can_edit_work_summary" string="Additional Notes" class="mt-3"/>
                            
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="alert alert-warning" role="alert" invisible="state != 'completed'">
                                        <i class="fa fa-check-circle me-2" title="Completion status"></i>
                                        <strong>Work Order Completed</strong>
                                        <p class="mb-0 mt-2">This work order has been completed. The resolution details above provide a summary of the work performed.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Maintenance Tasks Section -->
                    <div class="card border-0 shadow-sm mb-3" invisible="not show_maintenance_tasks">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fa fa-tasks me-2"></i>Maintenance Tasks Checklist</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-3" role="alert" invisible="schedule_id and job_plan_id">
                                <i class="fa fa-info-circle me-2" title="Information"></i>
                                <strong>Tasks are auto-generated from the job plan linked to this maintenance schedule.</strong>
                            </div>
                            
                            <div class="alert alert-warning mb-3" role="alert" invisible="schedule_id and job_plan_id">
                                <i class="fa fa-exclamation-triangle me-2" title="Warning"></i>
                                <strong>No job plan linked to this preventive workorder. Tasks are not available.</strong>
                                <p class="mb-0 mt-2">Please ensure the workorder has a linked maintenance schedule with a job plan to see tasks.</p>
                            </div>

                            <div class="alert alert-secondary mb-3" role="alert" invisible="not (schedule_id and job_plan_id)">
                                <i class="fa fa-info-circle me-2" title="Information"></i>
                                <strong>Task Information:</strong>
                                <p class="mb-0 mt-2">
                                    Total Tasks: <field name="workorder_task_ids" readonly="1" nolabel="1" invisible="1"/> 
                                    (tasks)
                                </p>
                                <p class="mb-0 mt-2">
                                    Job Plan: <field name="job_plan_id" readonly="1" nolabel="1" invisible="1"/>
                                    Schedule: <field name="schedule_id" readonly="1" nolabel="1" invisible="1"/>
                                </p>
                                <div class="mt-3">
                                    <button name="action_refresh_tasks" type="object" string="Refresh Tasks" class="btn btn-info btn-sm"
                                            icon="fa-refresh" invisible="not job_plan_id"/>
                                    <button name="action_load_mobile_tasks" type="object" string="Load Mobile Tasks" class="btn btn-warning btn-sm"
                                            icon="fa-download" invisible="not job_plan_id"/>
                                </div>
                            </div>

                            <field name="workorder_task_ids" create="false" invisible="not (schedule_id and job_plan_id)" string="Task List">
                                <list>
                                    <field name="name" string="Task Name" readonly="1"/>
                                    <field name="section_id" string="Task Section" readonly="1"/>
                                    <field name="description" string="Task Description" readonly="1" optional="show"/>
                                    <field name="is_done" widget="boolean_toggle" readonly="parent.state != 'in_progress'" string="Completed"/>
                                    <field name="before_image" widget="image" optional="show" string="Before Photo"/>
                                    <field name="after_image" widget="image" optional="show" string="After Photo"/>
                                    <button name="toggle_task_completion" type="object" string="Toggle Completion" class="btn btn-secondary btn-sm" invisible="parent.state != 'in_progress'"/>
                                    <button name="action_view_task_mobile" type="object" string="Edit Task Details" class="btn btn-primary btn-sm"/>
                                    <button name="action_row_click_mobile" type="object" string="Open Task" class="btn btn-link btn-sm" invisible="1"/>
                                </list>
                            </field>

                            <div class="mt-3" invisible="not (schedule_id and job_plan_id and workorder_task_ids)">
                                <h6 class="text-muted">Task Summary:</h6>
                                <div class="alert alert-info" role="alert">
                                    <i class="fa fa-info-circle me-2" title="Information"></i>
                                    Tasks are displayed in the table above. Use the table to view and manage individual tasks.
                                </div>
                            </div>

                            <div class="alert alert-warning mb-3" role="alert" invisible="workorder_task_ids or not (schedule_id and job_plan_id)">
                                <i class="fa fa-exclamation-triangle me-2" title="Warning"></i>
                                <strong>No tasks found for this work order.</strong>
                                <p class="mb-0 mt-2">This may happen if the job plan doesn't have any tasks defined, or if there's an issue with task generation.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Work Summary & Notes Section -->
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fa fa-sticky-note me-2"></i>Work Summary &amp; Notes</h5>
                        </div>
                        <div class="card-body">
                            <field name="work_done" placeholder="Describe the work performed, issues found, and solutions applied..." readonly="not can_edit_work_summary" string="Work Performed Summary"/>
                            <div class="row mt-3">
                                <div class="col-12 col-md-6">
                                    <field name="first_time_fix" widget="boolean_toggle" readonly="not can_edit_work_summary" string="First Time Fix (No Re-work)"/>
                                </div>
                                <div class="col-12 col-md-6">
                                    <field name="service_type" readonly="not can_edit_work_summary" string="Type of Service Provided"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Escalation History Section -->
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-warning text-white">
                            <h5 class="mb-0"><i class="fa fa-level-up me-2"></i>Escalation History</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-3" role="alert">
                                <i class="fa fa-info-circle me-2" title="Information"></i>
                                <strong>Escalation History</strong> - This section shows automatic escalations triggered by SLA breaches. 
                                Escalations are automatically created when work orders exceed their SLA deadlines and cannot be manually edited.
                            </div>
                            <field name="escalation_history" create="false" delete="false" readonly="1">
                                <list readonly="1">
                                    <field name="escalation_level" string="Level" readonly="1"/>
                                    <field name="escalation_type" string="Type" readonly="1"/>
                                    <field name="escalation_date" string="Triggered At" widget="datetime" readonly="1"/>
                                    <field name="escalation_reason" string="Reason" readonly="1"/>
                                    <field name="escalated_to_id" string="Escalated To" optional="show" readonly="1"/>
                                    <field name="resolution_date" string="Resolved At" widget="datetime" optional="show" readonly="1"/>
                                    <field name="status" string="Status" readonly="1"/>
                                </list>
                            </field>
                        </div>
                    </div>

                    <!-- Final Summary Section - Only visible when completed -->
                    <div class="card border-0 shadow-sm mb-3" invisible="state != 'completed'">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fa fa-check-circle me-2" title="Completion status"></i>Final Work Order Summary</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-success mb-3" role="alert">
                                <i class="fa fa-check-circle me-2" title="Completion status"></i>
                                <strong>Work Order Completed Successfully!</strong>
                                <p class="mb-0 mt-2">This work order has been completed and signed off. Below is the final summary.</p>
                            </div>
                            
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    <h6 class="text-muted">Total Time &amp; Cost:</h6>
                                    <p><strong>Total Work Hours:</strong> <field name="total_assignment_hours" readonly="1" nolabel="1"/> hours</p>
                                    <p><strong>Total Labor Cost:</strong> <field name="total_assignment_labor_cost" readonly="1" nolabel="1"/></p>
                                    <p><strong>Total Parts Cost:</strong> <field name="parts_cost" readonly="1" nolabel="1"/></p>
                                    <p><strong>Total Cost:</strong> <field name="total_cost" readonly="1" nolabel="1"/></p>
                                </div>
                                <div class="col-12 col-md-6">
                                    <h6 class="text-muted">Resolution Summary:</h6>
                                    <p><strong>Action Taken:</strong></p>
                                    <div class="border rounded p-2 bg-light">
                                        <field name="action_taken_resolution" readonly="1" nolabel="1"/>
                                    </div>
                                    <p class="mt-2"><strong>Additional Notes:</strong></p>
                                    <div class="border rounded p-2 bg-light">
                                        <field name="additional_notes" readonly="1" nolabel="1"/>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="alert alert-info" role="alert">
                                        <i class="fa fa-info-circle me-2" title="Information"></i>
                                        <strong>Note:</strong> This work order is now complete and all fields are read-only. 
                                        If changes are needed, please contact a supervisor to reopen the work order.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Responsive Workorder List View -->
    <record id="view_workorder_responsive_list" model="ir.ui.view">
        <field name="name">facilities.workorder.responsive.list</field>
        <field name="model">facilities.workorder</field>
        <field name="priority" eval="30"/>
        <field name="arch" type="xml">
            <list string="Work Orders" class="o_responsive_list">
                <field name="name" string="Work Order Title"/>
                <field name="asset_id" string="Equipment/Asset"/>
                <field name="building_id" string="Building Location"/>
                <field name="state" string="Current Status" widget="badge" decoration-info="state == 'draft'" decoration-warning="state == 'in_progress'" decoration-success="state == 'completed'" decoration-danger="state == 'cancelled'"/>
                <field name="priority" string="Priority Level" widget="badge" decoration-info="priority == '0'" decoration-warning="priority == '3'" decoration-danger="priority == '4'"/>
                <field name="sla_response_status" string="Response SLA Status" widget="badge" decoration-info="sla_response_status == 'on_time'" decoration-warning="sla_response_status == 'at_risk'" decoration-danger="sla_response_status == 'breached'"/>
                <field name="sla_resolution_status" string="Resolution SLA Status" widget="badge" decoration-info="sla_resolution_status == 'on_time'" decoration-warning="sla_resolution_status == 'at_risk'" decoration-danger="sla_resolution_status == 'breached'"/>
                <field name="work_order_type" string="Type" widget="badge" decoration-info="work_order_type == 'preventive'" decoration-warning="work_order_type == 'corrective'" decoration-danger="work_order_type == 'emergency'"/>
                <field name="approval_state" string="Approval Status" widget="badge" decoration-info="approval_state == 'draft'" decoration-warning="approval_state in ('submitted', 'supervisor')" decoration-success="approval_state == 'approved'" decoration-danger="approval_state == 'rejected'"/>
            </list>
        </field>
    </record>

    <!-- Responsive Workorder Action -->
    <record id="action_maintenance_workorder_responsive" model="ir.actions.act_window">
        <field name="name">Work Orders</field>
        <field name="res_model">facilities.workorder</field>
        <field name="view_mode">list,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'list', 'view_id': ref('facilities_management.view_workorder_responsive_list')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('facilities_management.view_workorder_responsive_form')})]"/>
        <field name="context">{'load_tasks': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first work order!
            </p>
            <p>
                Manage maintenance work orders with a responsive interface that works on both desktop and mobile devices.
            </p>
        </field>
    </record>
</odoo>
