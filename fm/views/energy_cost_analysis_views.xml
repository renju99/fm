<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Energy Cost Analysis List View -->
    <record id="view_energy_cost_analysis_list" model="ir.ui.view">
        <field name="name">facilities.energy.cost.analysis.list</field>
        <field name="model">facilities.energy.cost.analysis</field>
        <field name="arch" type="xml">
            <list string="Energy Cost Analysis" 
                  decoration-info="state == 'completed'" 
                  decoration-warning="state == 'review'"
                  decoration-success="state == 'approved'"
                  create="true" edit="true" delete="true">
                <field name="name"/>
                <field name="analysis_type"/>
                <field name="facility_id"/>
                <field name="analysis_date"/>
                <field name="total_energy_cost"/>
                <field name="state" widget="badge"/>
                <field name="variance_percentage" optional="hide"/>
                <field name="cost_trend" optional="hide"/>
                <field name="benchmark_performance" optional="hide"/>
                <field name="currency_id" invisible="1"/>
            </list>
        </field>
    </record>

    <!-- Energy Cost Analysis Form View -->
    <record id="view_energy_cost_analysis_form" model="ir.ui.view">
        <field name="name">facilities.energy.cost.analysis.form</field>
        <field name="model">facilities.energy.cost.analysis</field>
        <field name="arch" type="xml">
            <form string="Energy Cost Analysis">
                <header>
                    <button name="action_start_analysis" type="object" string="Start Analysis" 
                            invisible="state != 'draft'" class="btn-primary"/>
                    <button name="action_complete_analysis" type="object" string="Complete Analysis" 
                            invisible="state != 'calculating'" class="btn-success"/>
                    <button name="action_send_for_review" type="object" string="Send for Review" 
                            invisible="state != 'completed'" class="btn-info"/>
                    <button name="action_approve" type="object" string="Approve" 
                            invisible="state != 'review'" class="btn-primary"/>
                    <button name="action_archive" type="object" string="Archive" 
                            invisible="state not in ['completed', 'approved']" class="btn-secondary"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,calculating,completed,review,approved"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_meter_breakdown" type="object" 
                                class="oe_stat_button" icon="fa-bar-chart">
                            <field name="meter_cost_breakdown_ids" widget="statinfo" 
                                   string="Meter Breakdown"/>
                        </button>
                        <button name="action_view_facility_breakdown" type="object" 
                                class="oe_stat_button" icon="fa-building">
                            <field name="facility_cost_breakdown_ids" widget="statinfo" 
                                   string="Facility Breakdown"/>
                        </button>
                    </div>
                    
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Analysis Name"/>
                        </h1>
                        <h3>
                            <field name="analysis_code" readonly="1"/>
                        </h3>
                    </div>
                    
                    <group>
                        <group name="basic_info" string="Basic Information">
                            <field name="analysis_type"/>
                            <field name="analysis_date"/>
                            <field name="period_start_date"/>
                            <field name="period_end_date"/>
                            <field name="include_all_facilities"/>
                        </group>
                        <group name="scope" string="Scope">
                            <field name="facility_id" invisible="include_all_facilities == True"/>
                            <field name="building_id" invisible="include_all_facilities == True"/>
                        </group>
                    </group>
                    
                    <group>
                        <group name="cost_summary" string="Cost Summary">
                            <field name="total_energy_cost" readonly="1"/>
                            <field name="total_electricity_cost" readonly="1"/>
                            <field name="total_water_cost" readonly="1"/>
                            <field name="total_gas_cost" readonly="1"/>
                            <field name="total_steam_cost" readonly="1"/>
                            <field name="currency_id" readonly="1"/>
                        </group>
                        <group name="cost_metrics" string="Cost Metrics">
                            <field name="cost_per_sqm" readonly="1"/>
                            <field name="cost_per_occupant" readonly="1"/>
                            <field name="cost_per_hour" readonly="1"/>
                            <field name="cost_per_day" readonly="1"/>
                        </group>
                    </group>
                    
                    <group>
                        <group name="budget_analysis" string="Budget Analysis">
                            <field name="budgeted_cost"/>
                            <field name="variance_amount" readonly="1"/>
                            <field name="variance_percentage" readonly="1"/>
                            <field name="budget_performance" readonly="1"/>
                        </group>
                        <group name="trend_analysis" string="Trend Analysis">
                            <field name="previous_period_cost" readonly="1"/>
                            <field name="cost_change_amount" readonly="1"/>
                            <field name="cost_change_percentage" readonly="1"/>
                            <field name="cost_trend" readonly="1"/>
                        </group>
                    </group>
                    
                    <group>
                        <group name="benchmark_analysis" string="Benchmark Analysis">
                            <field name="industry_average_cost_per_sqm"/>
                            <field name="benchmark_performance" readonly="1"/>
                        </group>
                        <group name="peak_analysis" string="Peak Analysis">
                            <field name="peak_hours_cost" readonly="1"/>
                            <field name="off_peak_hours_cost" readonly="1"/>
                            <field name="peak_off_peak_ratio" readonly="1"/>
                        </group>
                    </group>
                    
                    <group>
                        <group name="seasonal_analysis" string="Seasonal Analysis">
                            <field name="seasonal_variance" readonly="1"/>
                            <field name="highest_cost_month" readonly="1"/>
                            <field name="lowest_cost_month" readonly="1"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Recommendations" name="recommendations">
                            <group>
                                <group>
                                    <field name="cost_optimization_opportunities" nolabel="1"/>
                                </group>
                                <group>
                                    <field name="energy_efficiency_recommendations" nolabel="1"/>
                                </group>
                            </group>
                            <group>
                                <field name="budget_recommendations" nolabel="1"/>
                            </group>
                        </page>
                        
                        <page string="Meter Breakdown" name="meter_breakdown">
                            <field name="meter_cost_breakdown_ids" readonly="1">
                                <list string="Meter Cost Breakdown">
                                    <field name="meter_name"/>
                                    <field name="meter_type"/>
                                    <field name="facility_name"/>
                                    <field name="total_cost"/>
                                    <field name="total_consumption"/>
                                    <field name="cost_per_unit"/>
                                    <field name="average_cost_per_reading"/>
                                    <field name="readings_count"/>
                                </list>
                            </field>
                        </page>
                        
                        <page string="Facility Breakdown" name="facility_breakdown">
                            <field name="facility_cost_breakdown_ids" readonly="1">
                                <list string="Facility Cost Breakdown">
                                    <field name="facility_name"/>
                                    <field name="total_cost"/>
                                    <field name="total_consumption"/>
                                    <field name="meter_count"/>
                                    <field name="cost_per_meter"/>
                                    <field name="consumption_per_meter"/>
                                </list>
                            </field>
                        </page>
                        
                        <page string="Approval" name="approval">
                            <group>
                                <group name="preparation" string="Preparation">
                                    <field name="prepared_by_id"/>
                                </group>
                                <group name="review" string="Review">
                                    <field name="reviewed_by_id"/>
                                    <field name="review_date"/>
                                </group>
                            </group>
                            <group>
                                <group name="approval" string="Approval">
                                    <field name="approved_by_id"/>
                                    <field name="approval_date"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Attachments" name="attachments">
                            <field name="attachment_ids" widget="many2many_binary"/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- Energy Cost Analysis Search View -->
    <record id="view_energy_cost_analysis_search" model="ir.ui.view">
        <field name="name">facilities.energy.cost.analysis.search</field>
        <field name="model">facilities.energy.cost.analysis</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="analysis_code"/>
                <field name="analysis_type"/>
                <field name="facility_id"/>
                <field name="building_id"/>
                <field name="prepared_by_id"/>
                
                <separator/>
                <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Calculating" name="calculating" domain="[('state', '=', 'calculating')]"/>
                <filter string="Completed" name="completed" domain="[('state', '=', 'completed')]"/>
                <filter string="Under Review" name="review" domain="[('state', '=', 'review')]"/>
                <filter string="Approved" name="approved" domain="[('state', '=', 'approved')]"/>
                
                <separator/>
                <filter string="Monthly" name="monthly" domain="[('analysis_type', '=', 'monthly')]"/>
                <filter string="Quarterly" name="quarterly" domain="[('analysis_type', '=', 'quarterly')]"/>
                <filter string="Annual" name="annual" domain="[('analysis_type', '=', 'annual')]"/>
                <filter string="Budget vs Actual" name="budget_vs_actual" domain="[('analysis_type', '=', 'budget_vs_actual')]"/>
                
                <separator/>
                <filter string="Over Budget" name="over_budget" domain="[('budget_performance', '=', 'over_budget')]"/>
                <filter string="Under Budget" name="under_budget" domain="[('budget_performance', '=', 'under_budget')]"/>
                <filter string="Increasing Cost Trend" name="increasing_trend" domain="[('cost_trend', '=', 'increasing')]"/>
                <filter string="Decreasing Cost Trend" name="decreasing_trend" domain="[('cost_trend', '=', 'decreasing')]"/>
                
                <separator/>
                <filter string="This Month" name="this_month" 
                        domain="[('analysis_date', '>=', datetime.datetime.now().strftime('%Y-%m-01')), ('analysis_date', '&lt;', (datetime.datetime.now() + relativedelta(months=1)).strftime('%Y-%m-01'))]"/>
                <filter string="This Quarter" name="this_quarter" 
                        domain="[('analysis_date', '>=', datetime.datetime.now().strftime('%Y-%m-01')), ('analysis_date', '&lt;', (datetime.datetime.now() + relativedelta(months=3)).strftime('%Y-%m-01'))]"/>
                <filter string="This Year" name="this_year" 
                        domain="[('analysis_date', '>=', datetime.datetime.now().strftime('%Y-01-01')), ('analysis_date', '&lt;', (datetime.datetime.now() + relativedelta(years=1)).strftime('%Y-01-01'))]"/>
                
            <filter string="Analysis Type" name="group_type" context="{'group_by': 'analysis_type'}"/>
            <filter string="Facility" name="group_facility" context="{'group_by': 'facility_id'}"/>
            <filter string="Status" name="group_status" context="{'group_by': 'state'}"/>
            <filter string="Budget Performance" name="group_budget" context="{'group_by': 'budget_performance'}"/>
            <filter string="Cost Trend" name="group_trend" context="{'group_by': 'cost_trend'}"/>
            <filter string="Analysis Date" name="group_date" context="{'group_by': 'analysis_date:month'}"/>
            </search>
        </field>
    </record>

    <!-- Energy Cost Analysis Graph View -->
    <record id="view_energy_cost_analysis_graph" model="ir.ui.view">
        <field name="name">facilities.energy.cost.analysis.graph</field>
        <field name="model">facilities.energy.cost.analysis</field>
        <field name="arch" type="xml">
            <graph string="Energy Cost Analysis" type="line">
                <field name="analysis_date" type="row"/>
                <field name="total_energy_cost" type="measure"/>
                <field name="budgeted_cost" type="measure"/>
            </graph>
        </field>
    </record>

    <!-- Energy Cost Analysis Pivot View -->
    <record id="view_energy_cost_analysis_pivot" model="ir.ui.view">
        <field name="name">facilities.energy.cost.analysis.pivot</field>
        <field name="model">facilities.energy.cost.analysis</field>
        <field name="arch" type="xml">
            <pivot string="Energy Cost Analysis">
                <field name="facility_id" type="row"/>
                <field name="analysis_date" type="col" interval="month"/>
                <field name="total_energy_cost" type="measure"/>
                <field name="budgeted_cost" type="measure"/>
                <field name="variance_percentage" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Energy Cost Analysis Actions -->
    <record id="action_energy_cost_analysis" model="ir.actions.act_window">
        <field name="name">Energy Cost Analysis</field>
        <field name="res_model">facilities.energy.cost.analysis</field>
        <field name="view_mode">list,form,graph,pivot</field>
        <field name="search_view_id" ref="view_energy_cost_analysis_search"/>
        <field name="context">{'search_default_this_month': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first energy cost analysis!
            </p>
            <p>
                Analyze energy costs across your facilities to identify optimization opportunities,
                track budget performance, and benchmark against industry standards.
            </p>
        </field>
    </record>
</odoo>
