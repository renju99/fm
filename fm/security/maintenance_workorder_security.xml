<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Enhanced Security Groups -->
        <record id="group_facilities_security_admin" model="res.groups">
            <field name="name">Facilities Security Administrator</field>
            <field name="comment">Full access to security settings and audit logs</field>
        </record>

        <record id="group_facilities_security_auditor" model="res.groups">
            <field name="name">Facilities Security Auditor</field>
            <field name="comment">Read-only access to security logs and audit trails</field>
        </record>

        <record id="group_facilities_high_priority" model="res.groups">
            <field name="name">Facilities High Priority Access</field>
            <field name="comment">Access to high priority and critical work orders</field>
        </record>

        <!-- Enhanced Access Control Lists - Removed duplicate access rules for facilities_workorder model -->
        <!-- Access rules for facilities_workorder are defined in ir.model.access.csv -->

        <!-- Access Log Access Control -->
        <record id="access_maintenance_workorder_access_log" model="ir.model.access">
            <field name="name">maintenance.workorder.access.log</field>
            <field name="model_id" ref="fm.model_maintenance_workorder_access_log"/>
            <field name="group_id" ref="fm.group_facilities_security_auditor"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="access_maintenance_workorder_access_log_admin" model="ir.model.access">
            <field name="name">maintenance.workorder.access.log.admin</field>
            <field name="model_id" ref="fm.model_maintenance_workorder_access_log"/>
            <field name="group_id" ref="fm.group_facilities_security_admin"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Error Log Access Control -->
        <record id="access_maintenance_workorder_error_log" model="ir.model.access">
            <field name="name">maintenance.workorder.error.log</field>
            <field name="model_id" ref="fm.model_maintenance_workorder_error_log"/>
            <field name="group_id" ref="fm.group_facilities_user"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="access_maintenance_workorder_error_log_manager" model="ir.model.access">
            <field name="name">maintenance.workorder.error.log.manager</field>
            <field name="model_id" ref="fm.model_maintenance_workorder_error_log"/>
            <field name="group_id" ref="fm.group_facilities_manager"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Record Rules for Enhanced Security -->
        <record id="rule_maintenance_workorder_security_user" model="ir.rule">
            <field name="name">Maintenance Work Order: User Access</field>
            <field name="model_id" ref="fm.model_facilities_workorder"/>
            <field name="domain_force">[
                '|',
                '|',
                ('created_by_id', '=', user.id),
                ('technician_id.user_id', '=', user.id),
                ('access_level', 'in', ['public', 'internal'])
            ]</field>
            <field name="groups" eval="[(4, ref('fm.group_facilities_user'))]"/>
        </record>

        <record id="rule_maintenance_workorder_security_technician" model="ir.rule">
            <field name="name">Maintenance Work Order: Technician Access</field>
            <field name="model_id" ref="fm.model_facilities_workorder"/>
            <field name="domain_force">[
                '|',
                '|',
                '|',
                ('created_by_id', '=', user.id),
                ('technician_id.user_id', '=', user.id),
                ('team_id.member_ids.user_id', '=', user.id),
                ('access_level', 'in', ['public', 'internal', 'confidential'])
            ]</field>
            <field name="groups" eval="[(4, ref('fm.group_maintenance_technician'))]"/>
        </record>

        <record id="rule_maintenance_workorder_security_manager" model="ir.rule">
            <field name="name">Maintenance Work Order: Manager Access</field>
            <field name="model_id" ref="fm.model_facilities_workorder"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('fm.group_facilities_manager'))]"/>
        </record>

        <record id="rule_maintenance_workorder_security_admin" model="ir.rule">
            <field name="name">Maintenance Work Order: Security Admin Access</field>
            <field name="model_id" ref="fm.model_facilities_workorder"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('fm.group_facilities_security_admin'))]"/>
        </record>

        <!-- High Priority Work Order Rules -->
        <record id="rule_maintenance_workorder_high_priority" model="ir.rule">
            <field name="name">Maintenance Work Order: High Priority Access</field>
            <field name="model_id" ref="fm.model_facilities_workorder"/>
            <field name="domain_force">[
                '|',
                ('priority', 'in', ['0', '1', '2']),
                ('access_level', 'in', ['public', 'internal'])
            ]</field>
            <field name="groups" eval="[(4, ref('fm.group_facilities_user'))]"/>
        </record>

        <record id="rule_maintenance_workorder_high_priority_technician" model="ir.rule">
            <field name="name">Maintenance Work Order: High Priority Technician Access</field>
            <field name="model_id" ref="fm.model_facilities_workorder"/>
            <field name="domain_force">[
                '|',
                ('priority', 'in', ['0', '1', '2', '3']),
                ('access_level', 'in', ['public', 'internal', 'confidential'])
            ]</field>
            <field name="groups" eval="[(4, ref('fm.group_maintenance_technician'))]"/>
        </record>

        <!-- Access Log Rules -->
        <record id="rule_maintenance_workorder_access_log_auditor" model="ir.rule">
            <field name="name">Access Log: Auditor Access</field>
            <field name="model_id" ref="fm.model_maintenance_workorder_access_log"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('fm.group_facilities_security_auditor'))]"/>
        </record>

        <record id="rule_maintenance_workorder_access_log_admin" model="ir.rule">
            <field name="name">Access Log: Admin Access</field>
            <field name="model_id" ref="fm.model_maintenance_workorder_access_log"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('fm.group_facilities_security_admin'))]"/>
        </record>

        <!-- Error Log Rules -->
        <record id="rule_maintenance_workorder_error_log_user" model="ir.rule">
            <field name="name">Error Log: User Access</field>
            <field name="model_id" ref="fm.model_maintenance_workorder_error_log"/>
            <field name="domain_force">[
                '|',
                ('user_id', '=', user.id),
                ('workorder_id.created_by_id', '=', user.id)
            ]</field>
            <field name="groups" eval="[(4, ref('fm.group_facilities_user'))]"/>
        </record>

        <record id="rule_maintenance_workorder_error_log_manager" model="ir.rule">
            <field name="name">Error Log: Manager Access</field>
            <field name="model_id" ref="fm.model_maintenance_workorder_error_log"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('fm.group_facilities_manager'))]"/>
        </record>
    </data>
</odoo>
